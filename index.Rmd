---
title: "Aplicación de Redes Neuronales Artificiales para la estimación de volúmenes de trozas de madera en rodales de *Pinus Radiata D.Don*"
author: "Patricio Said"
date: "dd/mm/aaaa"
output: 
  xaringan::moon_reader:
    seal: false
    css: [default, metropolis, metropolis-fonts , ninjutsu]
    nature: 
      slideNumberFormat: " "  
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
class: clear, center, middle

.center[## Aplicación de Redes Neuronales Artificiales para la estimación de volúmenes de trozas de madera en rodales de *Pinus Radiata D.Don*]

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html>
.left[
.font100[
Patricio Said <font size="2" color="white" style="text-decoration: line-through;">(WANTED)</font>
]
.font100[
dd/mm/aaaa
]
]
---
# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,


```{r  echo = F, message = F , eval = T, warning = F}
library(ggplot2)
library(sf)  # para la clase de datos
library(rnaturalearth) #información del mundo
library(rnaturalearthdata)
library(ggspatial) #brujula
library(readxl) 
#datos <- read_excel("C:/Users/psaid/Documents/carpeta_ubuntu/codigo R tesis/datos_inventarios.xlsx")
library(knitr)
library(kableExtra) 
library(tidyverse) 
library(tidyr)

  datos <- readxl::read_excel("datos/datos_clean.xlsx")
datos_tabla <- select(datos, DAP_MEDIO,DAP_MEDIO_DOMINANTE, ALTURA_MEDIA, ALT_MEDIA_DOMINANTE , IMS ,                        DENSIDAD, AREA_BASAL,  ALT_MEDIA_PODA, DENSIDAD_PODADOS, EDAD_OT) 
datos_tabla %>%      	
  gather()%>%    	
  group_by(key) %>%     	
  summarise_each(funs(n(),min, mean, max, sd), value) %>% 	
  mutate( CV = sd/mean * 100) %>%     	
  mutate( unidad = c("m","m","m","m²/ha","cm","cm","arb/ha","arb/ha","años", "-" )) %>%  
  mutate(key=c("Altura Dominante","Altura podada","Altura total","Área basal","DAP","DAP Dominante","Densidad","Densidad podados","Edad","Índice de sito"))  %>% 
  setNames(c("Variables","n","Mínimo","Media","Máximo", "Desv. Est.", "CV(%)","unidad")) %>%
  select( Variables, unidad, everything()) %>%    
  kable( format.args = list(decimal.mark = ',', big.mark = "."),
         digits = 2)%>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```


---
class: inverse, center, middle

# Metodología

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html> 

---
class:  clear,middle, center
background-image: url(img/esquema.svg)
background-size: 80%

---
# Antecedentes de la industria forestal

```{r echo=FALSE , warning= F, message= F}
library(highcharter)
datos <- readxl::read_excel("datos/superficies_plantaciones_1.xlsx") 
library(tidyverse)
datos <-  datos %>% gather(especie,Superficie,2:5) %>%  
                mutate(Superficie = Superficie /1000000) 
datos$especie <- factor(datos$especie , levels = c("Pino radiata","Eucalipto" ,"Otras especies", "Total" ), ordered = T) 
hc2 <- hchart(datos, "line", hcaes(x = Año, y = Superficie, group = especie), size = 10) %>% 
  hc_tooltip(table = TRUE, sort = TRUE) %>% 
  hc_title(
    text = "Superficie de plantaciones forestales (1973-2016)",
    useHTML = TRUE) %>% 
  hc_yAxis(title= list(text="Superficie (en millones de hectáreas)",
                       style = list(fontSize = "17px")),
           labels = list(style = list(fontSize = "12px"))) %>% 
  hc_credits(
    enabled = TRUE,
    text = "Fuente: INFOR")
htmlwidgets::saveWidget(hc2, "highchrt_ex2.html")
```

<iframe src="highchrt_ex2.html" width = "900px", height = "550px" frameBorder="0"></iframe>

???

37% Biobio, 24% araucania , 17% maule

---
# Antecedentes de la industria forestal

Exportaciones forestales en 2018  

```{r echo=FALSE , warning= F, message= F, fig.height=4, fig.width=13, fig.align= "center"}
datos5 <-  readxl::read_excel("datos/exportacion_pais.xlsx") 
datos5 <- datos5[order(datos5$Monto), ] 
datos5$País <- factor(datos5$País, levels = datos5$País[order(datos5$Monto)])

datos5 %>% filter(Porcentaje > 0.014) %>% 
  ggplot( aes(x = País, y = Monto)) + 
  geom_col(fill= "#6B8A47" ) +     
  coord_flip() +   
  geom_text(aes(  label = paste0(sub(".",",",
                                     as.character(round(Porcentaje*100,1)),fixed = T),"%")  ), 
            size = rel(5), fontface = "bold" , hjust= -0.1 , color = "gray33")+    
  scale_y_continuous(limits = c(0, 180) , 
                     labels =  function(x) format(x, big.mark = ".", scientific = FALSE)  ) +   
  theme_light()+   
  theme(        
        axis.title.y = element_text(size = rel(1.5), angle = 90),           
        axis.title.x = element_text(size = rel(1.5)),         
        axis.text.y =  element_text(size = rel(1.5)),
        axis.text.x = element_text(size = rel(1.5)))+       
   
  labs(     x = "País de destino",     y = 'Monto (US$ millones FOB)' , caption = "Fuente: INFOR"   )
```


```{r echo=FALSE , warning= F, message= F, fig.height=4, fig.width=13, fig.align= "center"}
library(treemapify)  
library(ggplot2) 
datos4 <- data.frame( Productos= c( "Pulpa", "Astillas pulpables", "Madera en trozas", "Madera aserrada", "Tableros y chapas", "Remanufactura", "Papeles y cartones ", "Otros"),
Monto = c( 3566.6, 394.1, 26.3, 636.9, 640.2, 911.9, 549.8, 131.6 ), Monto2 = c( "Pulpa\n$3.566,6", "Astillas pulpables\n$394,1", "Madera en trozas\n$26,3", "Madera aserrada\n$636,9", "Tableros y chapas\n$640,2", "Remanufactura\n$911,9", "Papeles y cartones\n$549,8", "Otros\n$131"    ) ) 
library(RColorBrewer)
library(ggfittext) 
ggplot(datos4, aes(area = Monto, fill = Productos , label = Monto2)) +   
  geom_treemap()+   
  theme_light()+   
  geom_treemap_text(colour = "white", place = "centre",                     grow = TRUE)+   theme(legend.position = "none")+   
  scale_fill_brewer(palette="Dark2")
```


---
class: split-two

# *Pinus Radiata D.Don* 

.column[
<div style="position: absolute; top: 30%; left:20%;">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/Pinus_radiata_range_map_2.png/768px-Pinus_radiata_range_map_2.png" width=350 height=350>

</div>

]

.column[
<div style="position: absolute; top: 20%;margin:0px auto; text-align:center;">

<img src="https://i.pinimg.com/originals/e7/0a/93/e70a93d0e37abb624e66b1b18a8557de.jpg" width=330 height=460>

</div>
]

---
class: split-two

# Rodales de Pino radiata 

.column[
<div style="position: absolute; top: 30%; left:10%;">
<img src="https://maderamen.com.ar/desarrollo-forestal/wp-content/uploads/sites/2/2018/05/radiata2.jpg" width=360 height=310>

</div>

]

.column[
<div style="position: absolute; top: 30%;margin:0px auto; text-align:center;">

<img src="https://infomadera.net/uploads/noticias/imagen_8575.jpg" width=360 height=310>

</div>
]

---
# El ciclo forestal 
<div style="position: absolute; top: 20%; left:20%;">

<img src="img/ciclo_forestal.svg" width=550>

</div>
---
class: clear
**Elaboración de madera contrachapada o plywood** (Fuente: cmpcmaderas.cl)
<div style="position: absolute; top: 10%; left:5%;">
<embed src="img/plywood.swf" width="780" height="655"></embed>

---
class: split-two
# Tratamientos silvícolas
## La poda
.column[
<div style="position: absolute; top: 30%; left:10%;">
<img src="img/poda2.svg" width=360 height=310>

</div>

]

.column[
<div style="position: absolute; top: 20%;margin:0px auto; text-align:center;">

<img src="img/poda.svg"  height=450>

</div>
]


---
background-image: url(img/raleo.svg)
background-size: 700px
background-position: 50% 50%
#  Tratamientos silvícolas
## El raleo


---
background-image: url(img/trozado.svg)
background-size: 880px
background-position: 50% 50%
# Trozado de los productos
---
class:  clear,middle, center
background-image: url(img/flujo-trad.svg)
background-size: 80%

---
class: inverse, center, middle

# Estimaciones imprecisas ⇒ Desviaciones volumen progradamado/cosechado
---
class:  clear,middle, center
background-image: url(img/flujo-trad.svg)
background-size: 80%

---
class:  clear,middle, center
background-image: url(img/flujo.svg)
background-size: 80%
---
class: split-two
# Redes neuronales artificiales

.row[
<div style="position: absolute; top: 30%; left:25%;">
<img src="img/neurona.svg" width=470 height=280>

</div>

]

.row[
<div style="position: absolute; top: 5%; left:30%;">

<img src="img/perceptron.svg" width=360 height=310>

</div>
]
---

# Redes neuronales artificiales

<div style="position: absolute; top: 15%; left:20%;">

<img src="img/nn.svg" width=550>

</div>

<div style="position: absolute; top: 64%; left:3%;">

<img src="img/applications.svg" width=900>

</div>

---
# Redes neuronales artificiales

#### Aplicaciones de RNA en la industria forestal:

* Modelo de Perceptrón multicapa para estimar calidad de madera aglomerada  (Melo y
Miguel, 2016).  
*  Modelo RNA con base radial para la predicción de la resistencia de tableros
aglomerados (Cook y Chiu, 1997; Fernández et al., 2008).
* Modelo RNA para clasificación de defectos en chapas de madera  (Pham y Sagiroglu, 2000; Ramírez Alonso
y Chacón Murguía, 2005).  
* RNA para clasificar dos tipos de coníferas en Islas Canarias (Esteban et al., 2009).  
* RNA que apoya a la detección de incendios forestales  (Alonso-Betanzos
et al., 2003).  
* Modelo de predicción de mortalidad en plantaciones forestales  (Hasenauer et al., 2001).  
* RNA para estimar cobertura forestal  (Rodríguez et al., 2002).
* Modelo de RNA para estimar alturas de diferentes especies forestales (López et al., 2012; Martins et al., 2016).  
* Predicción del índice de sitio en bosques del Mediterráneo (Aertsen et al. 2010).  
* Modelos de RNA para estimar crecimiento y volúmenes de diferentes especies forestales (Vinícius Oliveira Castro et al., 2013; López, Arce, y Arévalo 2012; Miguel et al., 2016; De Oliveira Lima et al., 2017; Martins et al., 2016; Vieira et al., 2018).  
---

class:  clear,middle, center
background-image: url(img/esquema.svg)
background-size: 80%

---
class: inverse, center, middle

# ¿Con qué datos trabajar?

---

# Requerimiento de datos

* Información dasométrica de los rodales (provenientes de **inventarios forestales**)  
  + Diámetro a la altura de pecho (DAP) (a 1,3 metros del suelo)
  + Altura total  
  + Densidad de árboles, densidad de árboles podados
  + Altura podada  
  + Altura dominante, DAP dominante  
  + Área basal  
--

* Variables que afectan a la productividad   
  + Zonas de crecimiento  
  + Tipo de suelo  
  + Esquema de manejo (régimen silvícola)  
--

* Volúmenes de productos cosechados y superficie cosechada (desde reportes de faenas)  
* Rendimientos estimados de productos por un modelo tradicional
* Indicadores: Índice de sitio, PLI (pruned log index)  

Otras variables recolectadas y que no fueron considerados para el conjunto final de datos: pendiente del rodal, tipo de máquinas en la cosecha, empresa cosechadora

---
# Zona de estudio

```{r out.width='100%', fig.height=7, eval=require('leaflet'),echo=FALSE  }
library(leaflet)
leaflet() %>% addTiles() %>% setView(-77.344, -34.597, zoom = 5) %>%
    addRectangles(
    lng1= -74.575, lat1=-34.886,  
    lng2= -70.192, lat2=-40.830, 
    fillColor = "transparent") %>% addProviderTiles(providers$Stamen.Toner)
```
---

# Inventarios forestales

<div style="position: absolute; top: 20%; left:7%;">

<img src="img/inventarios.svg" width=800>

</div>

---
# Zonas de crecimiento y tipos de suelos

<div style="position: absolute; top: 15%; left:5%;">

<img src="img/zona_suelo.svg" width=800>

</div>

---
# Exploración de los datos

```{r echo=FALSE , warning= F, message= F}
datos <- readxl::read_excel("datos/datos_inventarios.xlsx")

#datos3$COD_Z_CPINO <- as.factor(datos3$COD_Z_CPINO) 
#levels(datos3$COD_Z_CPINO) <- c("I" , "II" , "III" , "IV" , "V" , "VI" , "VII" , "VIII" , "IX" , "X")
datos$ESQUEMA <- factor(datos$ESQUEMA,     levels = c('INTENSIVO','EXTENSIVO' , "MULTIPROPOSITO" , "PULPABLE"),ordered = TRUE) 
levels(datos$ESQUEMA) <- c("Intensivo" , "Extensivo" , "Multipropósito" , "Pulpable") 

hc3 <- hchart(datos, "scatter", hcaes(x = DAP_MEDIO, y = ALTURA_MEDIA, group = ESQUEMA)) %>% 
  hc_tooltip(table = TRUE, sort = TRUE) %>% 
  hc_title(
    text = "Relación altura media y DAP medio por rodales.",
    useHTML = TRUE) %>% 
  hc_yAxis(title= list(text="Altura media (m)",
                       style = list(fontSize = "17px")),
           labels = list(style = list(fontSize = "12px"))) %>% 
  hc_xAxis(title= list(text="Dap medio (cm)",
                       style = list(fontSize = "17px")),
           labels = list(style = list(fontSize = "12px")))

htmlwidgets::saveWidget(hc3, "highchrt_ex3.html")
```


<iframe src="highchrt_ex3.html" width = "900px", height = "570px" frameBorder="0"></iframe>

---

# Exploración de los datos

```{r echo=FALSE , warning= F, message= F}
datos <- readxl::read_excel("datos/datos_inventarios.xlsx")

#datos3$COD_Z_CPINO <- as.factor(datos3$COD_Z_CPINO) 
#levels(datos3$COD_Z_CPINO) <- c("I" , "II" , "III" , "IV" , "V" , "VI" , "VII" , "VIII" , "IX" , "X")


hc4 <- hchart(datos, "scatter", hcaes(x = EDAD_OT, y = ALTURA_MEDIA, group = ESQUEMA)) %>% 
  hc_tooltip(table = TRUE, sort = TRUE) %>% 
  hc_title(
    text = "Relación la altura media del rodal y la edad en el inventario.",
    useHTML = TRUE) %>% 
  hc_yAxis(title= list(text="Altura media (m)",
                       style = list(fontSize = "15px")),
           labels = list(style = list(fontSize = "11px"))) %>% 
  hc_xAxis(title= list(text="Edad en el inventario (años)",
                       style = list(fontSize = "15px")),
           labels = list(style = list(fontSize = "11px"))) 

htmlwidgets::saveWidget(hc4, "highchrt_ex4.html")
```


<iframe src="highchrt_ex4.html" width = "900px", height = "600px" frameBorder="0"></iframe>

