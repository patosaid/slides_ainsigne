---
title: "Aplicación de Redes Neuronales Artificiales para la estimación de volúmenes de trozas de madera en rodales de *Pinus Radiata D.Don*"
author: "Patricio Said"
date: "dd/mm/aaaa"
output: 
  xaringan::moon_reader:
    seal: false
    css: [default, metropolis, metropolis-fonts , ninjutsu]
    nature: 
      slideNumberFormat: " "  
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
background-image: url(img/ucn.png)
background-size: 60px
background-position: 7% 10%
class: clear, center, middle

.center[## Aplicación de Redes Neuronales Artificiales para la estimación de volúmenes de trozas de madera en rodales de *Pinus Radiata D.Don*]

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html>
.left[
.font100[
Patricio Said <font size="2" color="white" style="text-decoration: line-through;">(WANTED)</font>
]
.font100[
dd/mm/aaaa
]
]

---

class: inverse, center, middle

# Entrenamiento de los modelos
<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html>

---

# Configuración de las RNA

#### Búsqueda de parámetros *"Grid Search"*  
* **Arquitectura de las redes** : 
  + **Capa de entrada**: Según las variables de entradas. [35] (nodos) para 15 variables, [17] para 8 variables, [7] 7 variables.
  + **Capas ocultas**: [20], [32], [50], [20:20], [256:256], [56:56],[20:20:20], [128:128:128],[300:300] , [100:300:100], [300:300:300],
[256:256:256], [56:56:56:56].
  + **Capa de salida**: Rendimiento de cada producto.  
* **Función de activación**:  
  + `tanh`
  + `rectifier` (`ReLU`)  
  + `maxout`   
* **Tasa de aprendizaje**:  
  +  0.005 ,0.02, 0.05, 0.1, 0.25, 0.5.  
* **Criterios de detención**:  
  + **Épocas**:  20, 50, 100, 500, 800.
  + **Rondas**:  3, 4.  
      + 4% de ECM.  
      
---
class: inverse, center, middle

# Evaluación de los resultados
<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html>
---
# Métricas de precisión   

Para la evaluación de los modelos se consideraron:  

$${ECM}=\frac{1}{n}\sum_{i=1}^{n}(y_{i}-\hat{y_{i}})^{2}$$
$${RECM}=\sqrt{\frac{1}{n}\sum_{i=1}^{n}(y_{i}-\hat{y_{i}})^{2}}$$
$${EAM}=\frac{1}{n}\sum_{i=1}^{n}|y_{i}-\hat{y_{i}}|$$
$${R}_{y\hat{y}}=\frac{n\sum y_{i}\hat{y_{i}}-\sum y_{i}\sum\hat{y_{i}}}{\sqrt{n\sum y_{i}^{2}-(\sum y_{i})^{2}}\sqrt{n\sum\hat{y}_{i}^{2}-(\sum\hat{y_{i}})^{2}}}$$
donde, $y_{i}$ rendimiento observado , $\hat{y_{i}}$ rendimiento estimadio y $n$ cantidad de observaciones.  

---

```{r  echo = F, message = F , eval = T, warning = F}
library(knitr)
library(kableExtra) 
library(tidyverse) 
library(tidyr)
datos_tabla <- readxl::read_excel("datos/tabla_errores.xlsx")

datos_tabla %>% 
  kable( format.args = list(decimal.mark = ',', big.mark = "."),
         col.names = c("Salida", "Modelo",rep(c("ECM","RECM","EAM","R"),3)), 
         digits = c(1,1,rep(c(2,2,2,4),3)))%>%    		
  kable_styling(bootstrap_options =c( "condensed", "stripped"),font_size = 13)%>% 
  add_header_above(c(" "=2, "Entrenamiento (n = 608)"= 4, "Validación (n = 127)" = 4, "Prueba (n = 129)" = 4)) %>% 
     collapse_rows(columns = 1, valign = "top") 
```
---

```{r  echo = F, message = F , eval = T, warning = F}
 datos_tabla <- readxl::read_excel("datos/tabla_errores.xlsx")

datos_tabla %>% 
  kable( format.args = list(decimal.mark = ',', big.mark = "."),
         col.names = c("Salida", "Modelo",rep(c("ECM","RECM","EAM","R"),3)), 
         digits = c(1,1,rep(c(2,2,2,4),3)))%>%    		
  kable_styling(bootstrap_options =c( "condensed", "stripped"),font_size = 13)%>% 
  add_header_above(c(" "=2, "Entrenamiento (n = 608)"= 4, "Validación (n = 127)" = 4, "Prueba (n = 129)" = 4)) %>% 
     collapse_rows(columns = 1, valign = "top") %>% 
  row_spec(c(3,7,11,15), bold = T, color = "white", background = "#D7261E") %>% 
  row_spec(c(3,7,11,15)+1, bold = T)
```
---
# Configuraciones de los modelos de RNA

```{css, echo=F}
    /* Table width = 100% max-width */

    .remark-slide table{
        width: 100%;
    }

    /* Change the background color to white for shaded rows (even rows) */

    .remark-slide thead, .remark-slide tr:nth-child(2n) {
        background-color: white;
    }
```

```{r  echo = F, message = F , eval = T, warning = F}

tabla<- readxl::read_excel("datos/resultados_1.xlsx")

tabla <- tabla%>% mutate(tasa_a= str_replace(tasa_a,"0.","0,"))
tabla$...1 <- paste("RNA" , c(1:12),sep = "")
 tabla %>%   select(Salida, everything()) %>% 
  kable("html", booktabs= T,col.names = c("Salida" , "Modelo","Entradas", "Capas ocultas", "F(X)","$\\alpha$" ))%>%    		
  kable_styling(bootstrap_options =c("hover", "condensed", "stripped"),font_size = 13) %>% 
   collapse_rows(columns = 1, valign = "middle") %>% 
  footnote(symbol_manual = "",
           symbol =("Donde, DAP: diámetro a la altura de pecho promedio(cm); DAP Dom: diámetro a la altura de pecho dominante; HT: altura total media (m); H Dom: altura dominante (m); D: densidad media (arb/ha); DP: densidad podada (arb/ha); PP: proporción podada (%); G: área basal (m²/ha); E: edad en inventario (años); índice de sitio (m); HP: altura podada media (m), PLI: pruned log index (binario); TZ: tipo zona de crecimiento; TE: tipo de esquema de manejo; TS: tipo de suelo; $\\alpha$ = tasa de aprendizaje. Variable de salida en m³/ha."),threeparttable = T)    
 

```

---
# Configuraciones de los modelos de RNA

```{css, echo=F}
    /* Table width = 100% max-width */

    .remark-slide table{
        width: 100%;
    }

    /* Change the background color to white for shaded rows (even rows) */

    .remark-slide thead, .remark-slide tr:nth-child(2n) {
        background-color: white;
    }
```

```{r  echo = F, message = F , eval = T, warning = F}

tabla<- readxl::read_excel("datos/resultados_1.xlsx")

tabla <- tabla%>% mutate(tasa_a= str_replace(tasa_a,"0.","0,"))
tabla$...1 <- paste("RNA" , c(1:12),sep = "")
 tabla %>%   select(Salida, everything()) %>% 
  kable("html", booktabs= T,col.names = c("Salida" , "Modelo","Entradas", "Capas ocultas", "F(X)","$\\alpha$" ))%>%    		
  kable_styling(bootstrap_options =c("hover", "condensed", "stripped"),font_size = 13) %>% 
   collapse_rows(columns = 1, valign = "middle")  %>% 
  row_spec(c(3,6,9,12), bold = T, color = "white", background = "#D7261E") %>% 
  footnote(symbol_manual = "",
           symbol =("Donde, DAP: diámetro a la altura de pecho promedio(cm); DAP Dom: diámetro a la altura de pecho dominante; HT: altura total media (m); H Dom: altura dominante (m); D: densidad media (arb/ha); DP: densidad podada (arb/ha); PP: proporción podada (%); G: área basal (m²/ha); E: edad en inventario (años); índice de sitio (m); HP: altura podada media (m), PLI: pruned log index (binario); TZ: tipo zona de crecimiento; TE: tipo de esquema de manejo; TS: tipo de suelo; $\\alpha$ = tasa de aprendizaje. Variable de salida en m³/ha."),threeparttable = T)  

```

---
# Dispersión de errores (Prueba)

```{r echo=FALSE , warning= F, message= F, fig.height=7.4, fig.width=10, fig.align= "center"}
datos_2 <- readxl::read_excel("datos/tabla_errores_graficas.xlsx") 
library(ggplot2)
datos_2 %>%  
  mutate(conjunto = factor(conjunto,
                        levels=c("train", "valid","test"), 
                        labels = c("Entrenamiento","Validación","Prueba"))) %>% 
  mutate(producto = factor(producto_2, 
                       labels = c("Clear A","Clear B","Industrial","Pulpable" ))) %>% 
  mutate(error = real - estimado) %>%
  filter(conjunto == "Prueba") %>% 
ggplot( aes(x = estimado , y= error, color =Modelo))+
  geom_point(alpha = 1, size= 2)+       
  labs(x= "Estimado", y= "Error")+    
  labs(color = "Modelo")+     
  facet_wrap(~ producto ,ncol = 2,  scales = "free" )+    
  theme_light()+ 
  theme(legend.position="bottom",legend.box.spacing = unit(0, "cm"), 
                legend.spacing.y = unit(1, 'cm'),
        strip.text.x = element_text(margin = margin(0.1, 0.1, 0.1, 0.1, "cm") , 
                                    size = 12, color = "black") , 
        axis.text.x = element_text(size = 10), 
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        legend.text = element_text(size = 12),
        legend.title  = element_text(size = 12))
```
---
# Dispersión de errores (Prueba)

```{r echo=FALSE , warning= F, message= F, fig.height=8, fig.width=10, fig.align= "center"}
datos_2 <- readxl::read_excel("datos/tabla_errores_graficas.xlsx") 
datos_2 %>%  
  mutate(conjunto = factor(conjunto,levels=c("train", "valid","test"), 
                                    labels = c("Entrenamiento","Validación","Prueba"))) %>% 
  mutate(producto = factor(producto_2, 
                                    labels = c("Clear A","Clear B","Industrial","Pulpable" ))) %>% 
  mutate(error = real - estimado) %>% 
  filter(conjunto == "Prueba")%>% 
ggplot( aes(x=error, fill=Modelo)) +   
  geom_histogram( position="dodge", bins = 8, alpha= 1)+    
  labs(y= "Frecuencia", x= "Error", color= "Modelo" , fill="Modelo")+
  theme_light()+    
  facet_wrap(~producto,ncol = 2,  scales = "free")+  
  theme(legend.position="bottom",legend.box.spacing = unit(0, "cm"), 
                legend.spacing.y = unit(1, 'cm'),
        strip.text.x = element_text(margin = margin(0.1, 0.1, 0.1, 0.1, "cm") , 
                                    size = 12, color = "black") , 
        axis.text.x = element_text(size = 10), 
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        legend.text = element_text(size = 12),
        legend.title  = element_text(size = 12)
  ) 
```
---
# Historial del RECM en el entrenamiento

<div style="position: absolute; top: 20%; left:5%;">

<img src="img/historial_rmse.svg" width=800>

</div>

---
# Acerca de los resultados

* Capas ocultas  
* Funciones y tasas de activación  
* Variables de importacias



---
class: inverse, middle, center  

# Implementación

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html>

---
background-image: url(img/paquetes.png)
background-size: 800px
background-position: 50% 8%
# Software utilizado  

---

# Web app: <a href="https://psaid.shinyapps.io/ainsigne/ "> psaid.shinyapps.io/ainsigne </a>


<div class = "l-page"  style="top: 10%; left:0%;">
<iframe src="https://psaid.shinyapps.io/ainsigne/" width="700%" height="550px"
style="border:none;"></iframe>
</div>

---


class: inverse, center, middle

# Anexos

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=720px></html>
---
background-image: url(img/anexo/1.PNG)
background-size: 750px
background-position: 50% 35%
# El perceptrón multicapa MLP

---
background-image: url(img/anexo/2.PNG)
background-size: 500px
background-position: 45% 35%
# El perceptrón multicapa MLP

---
class: split-two
background-image: url(img/anexo/3.PNG)
background-size: 700px
background-position: 50% 10%
# El perceptrón multicapa MLP

.row[

]

.row[
$$ W_{ij} Y_i = V_j$$
$$ Y_j = F(V_j)$$
]
.row[

<div style="position: absolute; top: 68%; left:10%;">
<img src="img/anexo/fun.PNG"  height=250>

</div>
]

---
background-image: url(img/anexo/gradiente.PNG)
background-size: 850px
background-position: 50% 35%
# El perceptrón multicapa MLP

### Descenso de la gradiente 

---
background-image: url(img/anexo/gradiente2.PNG)
background-size: 750px
background-position: 50% 55%
# El perceptrón multicapa MLP

### Descenso de la gradiente 

---
background-image: url(img/anexo/valle.PNG)
background-size: 750px
background-position: 50% 55%
# El perceptrón multicapa MLP

### Descenso de la gradiente 

---
background-image: url(img/anexo/gradiente3.PNG)
background-size: 600px
background-position: 50% 10%
# El perceptrón multicapa MLP

--

<div style="position: absolute; top: 40%; left:15%;">
<img src="img/anexo/formulas.PNG"  height=380>

</div>

---
# Variables de importancia

<div style="position: absolute; top: 20%; left:5%;">

<img src="img/var_imp.svg" width=800>

</div>

---

# Referencias   


<div style="font-size:12pt">

<ul>
<li>Aertsen, Wim, Vincent Kint, Jos van Orshoven, Kürşad Özkan, y Bart Muys. 2010. «Comparison and ranking of different modelling techniques for prediction of site index in Mediterranean mountain forests». Ecological Modelling 221 (8):1119-30.</li> 
<li>Alonso-Betanzos, A., Fontenla-Romero, O., Guijarro-Berdinas, B., Hernández-Pereira, E., Andrade, M. I. P., Jiménez, E., Soto, J. L. L., y Carballas, T. (2003). An intelligent system for forest fire risk prediction and fire fighting management in galicia. Expert Systems with Applications, 25(4):545–554.</li>  
<li>Cook, D. F. y Chiu, C.-C. (1997). Predicting the internal bond strength of particleboard, utilizing a radial basis function neural network. Engineering Applications of Artificial Intelligence , 10(2):171–177.</li> 
<li>De Oliveira Lima, Mirella Basileu, Ilvan Medeiros Lustosa Junior, Elian Meneses Oliveira, J&essica Cristina Barbosa Ferreira, Kálita Luis Soares, y Eder Pereira Miguel. 2017. «Artificial neural networks in whole-stand level modeling of Eucalyptus plants». African Journal of Agricultural Research 12 (7): 524-34.</li>  
<li>Esteban, L. G., Fernández, F. G., de Palacios de Palacios, P., Romero, R. M., y Cano, N. N. (2009). Artificial neural networks in wood identification: The case of two juniperus species from the canary islands. IAWA Journal, 30(1):87–94.</li>
<li>Fernández, F. G., Esteban, L. G., Palacios, P. D., Navarro, M., y Conde, M. (2008). Prediction of standard particleboard mechanical properties utilizing an artificial neural network and subsequent comparison with a multivariate regression model. Investigación Agraria: Sistemas y Recursos Forestales, 17(2):178.</li>
<li>Hasenauer, H., Merkl, D., y Weingartner, M. (2001). Estimating tree mortality of norway spruce stands with neural networks. Advances in Environmental Research, 5(4):405–414.</li> 
<li>Haykin, Simon S. 2009. Neural networks and learning machines/Simon Haykin. New York: Prentice Hall.</li> 
Lopez, J., Arce, C., y Arévalo, R. (2012). Aplicación de la técnica de redes neuronales para la predicción de la altura de árboles de algunas especies maderables promisorias presentes en plantaciones forestales de colombia. Revista Tumbaga, 7:97–106.</li>


</ul>
</div>

---
# Referencias  

<div style="font-size:12pt">

<ul>
<li>Martins, E., Binoti, M., Leite, H., Binoti, D., y Dutra, G. (2016). Configuracao de redes neurais artificiais para estimacao da altura total de árvores de eucalipto. Revista Brasileira de Ciencias Agrárias - Brazilian Journal of Agricultural Sciences, 11(2):117–123.</li>
<li>Melo, R. R. d. y Miguel, E. P. (2016). Use of artificial neural networks in predicting particleboard quality parameters. Revista Arvore, 40(5):949–958.</li>
<li>Pham, D. T. y Sagiroglu, S. (2000). Neural network classification of defects in veneer boards. Proceedings of the Institution of Mechanical Engineers, Part B: Journal of Engineering Manufacture , 214(3):255–258.</li> 
<li>Ramírez Alonso, G. M. d. J. y Chacón Murguía, M. I. (2005). Clasificación de defectos en madera utilizando redes neurales artificiales. Computación y Sistemas, 9(1):17–27.</li>
<li>Rodríguez, E. B., P´ erez, E. V., Ovalle, Á. L., y Dom´ınguez, S. T. (2002). Aplicación de redes neuronales artificiales y técnicas sig para la predicción de coberturas forestales. Revista Chapingo. Serie Ciencias Forestales y del Ambiente, 8(1):31–37.</li>
<li>Tariq Rashid (2007). A Gentle Introductionto Neural Networks(with Python) PyCon Italy, https://www.pycon.it/media/conference/slides/a-gentle-introduction-to-neural-networks-with-python.pdf.</li>
<li>Vinícius Oliveira Castro, Renato, Carlos Pedro Boechat Soares, Helio Garcia Leite, Agostinho Lopes de Souza, Gilciano Saraiva Nogueira, y Fabrina Bolzan Martins. 2013. «Individual growth model for Eucalyptus stands in Brazil using artificial neural network». ISRN Forestry 2013.</li>
</ul>
</div>




